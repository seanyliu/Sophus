<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <script src="js/jsGameSoup/js/jsgamesoup.js"></script>
  <script src="js/jsGameSoup/js/random.js"></script>
  <script src="js/jsGameSoup/js/collisions.js"></script>
  <script src="js/map.js"></script>
  <script src="js/AsteroidsTNG.js"></script>
<script type="text/javascript">

/**
 * GameSoup starts with this function
 */
function startSophus(gs) {

  /**
   * Game world
   */
  function World() {

    // called every frame to draw this entity
    this.draw = function() {
      gs.clear();
      gs.background('rgba(100, 100, 100, 1.0)');
    }

		this.player = null;
		this.x = 0;
		this.y = 0;
		this.w = gs.width / 2;
		this.h = gs.height / 2;
		this.quadrant = [0, 0];
		// our procedural map generator with seedable deterministic random number generator
		var map = new Map(new SeedableRandom());
		this.relx = 0;
		this.rely = 0;
		
		this.setPlayer = function(player) {
			this.player = player;
			this.x = player.x;
			this.y = player.y;
			this.updateQuadrant();
		}
		
		this.updateQuadrant = function() {
			this.quadrant = [Math.floor(this.player.x / gs.width),
				Math.floor(this.player.y / gs.height)];
			this.getQuadrant(this.quadrant);
		}
		
		this.cameraX = function() {
			return this.relx;
		}
		
		this.cameraY = function () {
			return this.rely;
		}
  }

	/*** A background parallax star ***/
	function Star(world) {
		this.world = world;
		this.rate = gs.random(0.5, 1.0);
		this.size = Math.round(gs.random(0, 3));
		this.x = gs.random(0, 10000);
		this.y = gs.random(0, 10000);
		this.fs = 'rgba(255, 255, 255, ' + (this.rate - 0.2) + ')';
		
		this.update = function() {
		}
		
		this.getX = function() {
			return Math.round((this.x - this.world.cameraX()) * this.rate % gs.width);
		}
		
		this.getY = function() {
			return Math.round((this.y - this.world.cameraY()) * this.rate % gs.height);
		}
		
		if (this.size > 1.0) {
			this.draw = function(c) {
				c.strokeStyle = this.fs;
				c.beginPath();
				c.arc(this.getX(), this.getY(), this.size, 0, Math.PI*2, true);
				c.closePath();
				c.stroke();
			}
		} else {
			this.draw = function(c) {
				c.fillStyle = this.fs;
				var sx = this.getX() - 0.5;
				var sy = this.getY() - 0.5;
				c.beginPath();
				c.rect(sx, sy, 1, 1);
				for (var i=0; i<2; i++) {
					for (var j=0; j<2; j++) {
						c.rect(sx + (i * 2 - 1) * 2, sy + (j * 2 - 1) * 2, 1, 1);
						c.rect(sx + (i * 2 - 1), sy + (j * 2 - 1), 1, 1);
					}
				}
				c.closePath();
				c.fill();
				
			}
		}
	}

  var world = new World();
  gs.addEntity(world);
  gs.addEntity(new Star(world));
  gs.addEntity(new Star(world));
  gs.addEntity(new Star(world));
  gs.addEntity(new Star(world));
  gs.addEntity(new Star(world));
}

</script>
<style>
</style>
</head>
<body>
  <canvas jsgs="startAsteroidsTNG" fps="30" width="480" height="320"></canvas>
  <canvas jsgs="startSophus" fps="30" width="480" height="320"></canvas>
</body>
</html>
